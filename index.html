<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>内推宝典 - 计算机求职内推信息整合平台</title>
    <meta name="description" content="专业的计算机求职内推信息整合平台，聚合牛客、力扣、小红书、脉脉等平台的最新内推信息">
    <meta name="keywords" content="内推,求职,计算机,校招,社招,实习,程序员,工程师">
    <meta name="author" content="内推宝典">
    
    <!-- PWA相关 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#a8d8ea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="内推宝典">
    
    <!-- 图标 -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    
    <!-- 样式 -->
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="js/data-manager.js" as="script">
    <link rel="preload" href="data/jobs.json" as="fetch" crossorigin="anonymous">
</head>
<body>
    <!-- 顶部导航 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-handshake"></i>
                <span>内推宝典</span>
            </div>
            <div class="nav-menu">
                <a href="#home" class="nav-link active">首页</a>
                <a href="#jobs" class="nav-link">职位列表</a>
                <a href="#search" class="nav-link">高级搜索</a>
                <a href="#analytics" class="nav-link">数据分析</a>
                <a href="#about" class="nav-link">关于</a>
                <a href="#settings" class="nav-link">设置</a>
            </div>
            <div class="nav-mobile-toggle" id="navToggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </nav>

    <!-- 面包屑导航 -->
    <div class="breadcrumb-container">
        <div class="breadcrumb" id="breadcrumb">
            <span class="breadcrumb-item active">首页</span>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <main class="main-content">
        <div class="page-content">
            <!-- 页面内容将通过路由动态加载 -->
            <div class="page-loading">
                <div class="loading-spinner"></div>
                <p>页面加载中...</p>
            </div>
        </div>
    </main>

    <!-- 底部信息 -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>内推宝典</h4>
                    <p>专业的计算机求职内推信息整合平台</p>
                    <div class="footer-links">
                        <a href="#about" class="route-link">关于我们</a>
                        <a href="#settings" class="route-link">使用帮助</a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4>数据来源</h4>
                    <div class="footer-links">
                        <a href="https://www.nowcoder.com" target="_blank">牛客网</a>
                        <a href="https://leetcode.cn" target="_blank">力扣</a>
                        <a href="https://www.xiaohongshu.com" target="_blank">小红书</a>
                        <a href="https://maimai.cn" target="_blank">脉脉</a>
                    </div>
                </div>

                <div class="footer-section">
                    <h4>联系我们</h4>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>lvyovo01@gmail.com</span>
                        </div>
                        <div class="contact-item">
                            <i class="fab fa-github"></i>
                            <span>GitHub开源</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 内推宝典. 数据每日更新，仅供参考</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript模块 -->
    <script src="js/data-manager.js"></script>
    <script src="js/router.js"></script>
    <script src="js/advanced-search.js"></script>
    <script src="js/data-visualization.js"></script>
    <script src="js/main.js"></script>
    
    <!-- PWA和Service Worker -->
    <script>
        // 注册Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW注册成功:', registration);
                        
                        // 检查更新
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // 有新版本可用
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('SW注册失败:', error);
                    });
                    
                // 监听SW消息
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data.type === 'DATA_UPDATED') {
                        console.log('数据已更新');
                        // 可以在这里刷新页面数据
                    }
                });
            });
        }
        
        // 显示更新通知
        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.className = 'update-notification';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>发现新版本！</span>
                    <button onclick="updateApp()">更新</button>
                    <button onclick="dismissUpdate()">稍后</button>
                </div>
            `;
            document.body.appendChild(notification);
        }
        
        // 更新应用
        function updateApp() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistration().then(registration => {
                    if (registration && registration.waiting) {
                        registration.waiting.postMessage({ type: 'SKIP_WAITING' });
                        window.location.reload();
                    }
                });
            }
        }
        
        // 关闭更新通知
        function dismissUpdate() {
            const notification = document.querySelector('.update-notification');
            if (notification) {
                notification.remove();
            }
        }
        
        // PWA安装提示
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallPrompt();
        });
        
        function showInstallPrompt() {
            const installPrompt = document.createElement('div');
            installPrompt.className = 'install-prompt';
            installPrompt.innerHTML = `
                <div class="prompt-content">
                    <i class="fas fa-download"></i>
                    <span>安装内推宝典应用到桌面</span>
                    <button onclick="installApp()">安装</button>
                    <button onclick="dismissInstall()">稍后</button>
                </div>
            `;
            document.body.appendChild(installPrompt);
        }
        
        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`用户选择: ${outcome}`);
                deferredPrompt = null;
                dismissInstall();
            }
        }
        
        function dismissInstall() {
            const prompt = document.querySelector('.install-prompt');
            if (prompt) {
                prompt.remove();
            }
        }
        
        // 性能监控和应用初始化
        window.addEventListener('load', () => {
            // 记录页面加载性能
            const perfData = performance.getEntriesByType('navigation')[0];
            console.log('页面加载时间:', perfData.loadEventEnd - perfData.fetchStart, 'ms');
            
            // 初始化路由系统
            window.router = new Router();
            
            // 移动端导航切换
            const navToggle = document.getElementById('navToggle');
            const navMenu = document.querySelector('.nav-menu');
            
            navToggle.addEventListener('click', () => {
                navMenu.classList.toggle('active');
                navToggle.querySelector('i').classList.toggle('fa-bars');
                navToggle.querySelector('i').classList.toggle('fa-times');
            });
            
            // 点击外部关闭移动端菜单
            document.addEventListener('click', (e) => {
                if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                    navMenu.classList.remove('active');
                    navToggle.querySelector('i').classList.add('fa-bars');
                    navToggle.querySelector('i').classList.remove('fa-times');
                }
            });
        });
        
        // 键盘快捷键
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + K: 快速跳转到搜索页面
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                window.router.navigate('#search');
            }
            
            // Alt + H: 回到首页
            if (e.altKey && e.key === 'h') {
                e.preventDefault();
                window.router.navigate('#home');
            }
            
            // Esc: 关闭模态框
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal-overlay');
                modals.forEach(modal => modal.remove());
            }
        });
    </script>
    
    <!-- 样式增强 -->
    <style>
        /* 面包屑导航样式 */
        .breadcrumb-container {
            background: var(--background-color);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 0;
        }
        
        .breadcrumb {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .breadcrumb-item {
            color: var(--text-secondary);
        }
        
        .breadcrumb-item.active {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .breadcrumb-item a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
        }
        
        .breadcrumb-item a:hover {
            color: var(--primary-color);
        }
        
        .breadcrumb-separator {
            margin: 0 0.5rem;
            color: var(--text-secondary);
        }
        
        /* 页面内容容器 */
        .page-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
            min-height: 60vh;
            transition: all 0.3s ease;
        }
        
        /* 加载状态 */
        .page-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 错误页面 */
        .page-error {
            text-align: center;
            padding: 4rem 2rem;
        }
        
        .page-error i {
            font-size: 4rem;
            color: var(--danger-color);
            margin-bottom: 1rem;
        }
        
        .page-error h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        .page-error p {
            margin-bottom: 2rem;
            color: var(--text-secondary);
        }
        
        /* 移动端导航 */
        .nav-mobile-toggle {
            display: none;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .nav-mobile-toggle {
                display: block;
            }
            
            .nav-menu {
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--surface-color);
                border-top: 1px solid var(--border-color);
                box-shadow: var(--shadow-lg);
                flex-direction: column;
                padding: 1rem 0;
                transform: translateY(-10px);
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .nav-menu.active {
                transform: translateY(0);
                opacity: 1;
                visibility: visible;
            }
            
            .nav-link {
                padding: 0.75rem 1.5rem;
                border-bottom: 1px solid var(--border-color);
            }
            
            .nav-link:last-child {
                border-bottom: none;
            }
            
            .page-content {
                padding: 1rem;
            }
        }
        
        /* 更新通知和安装提示样式 */
        .update-notification,
        .install-prompt {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface-color);
            border: 1px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            animation: slideIn 0.3s ease-out;
            max-width: 300px;
        }
        
        .notification-content,
        .prompt-content {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .update-notification button,
        .install-prompt button {
            background: var(--primary-color);
            color: var(--text-primary);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: var(--transition);
        }
        
        .update-notification button:hover,
        .install-prompt button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</body>
</html>